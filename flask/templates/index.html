<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="{{ fav_icon }}" />
    <title>CutCat</title>
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script type="text/babel">
      function Main() {
        const [msg, setMsg] = React.useState([]);
        const socket = io.connect(
          "http://" + document.domain + ":" + location.port
        );

        React.useEffect(() => {
          // // this will increase file size, but I like it, who cares.
          // console.log(
          //   "%c                               .=#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%*-                    \n                              =@@@@%%%%%%%%%@@@@%%%%%%@@@@%%%%%%%%%@@@%:                  \n                             -@@@=          %@@#     .@@@+         .*@@@.                 \n                             *@@%           :@@@%+-=+@@@%           .@@@-                 \n                             *@@%            .*@@@@@@@%+            .@@@-                 \n                    :=+=-.   *@@%               :-=--.              .@@@-                 \n                  .%@@@@@@@+.*@@#                                   .@@@-                 \n                  =@@@--+%@@@@@@#                                   .@@@-                 \n                  =@@@.   :%@@@@#                                   .@@@-                 \n                  -@@@      #@@@#   .*.                      =.     .@@@-                 \n                   .-.       @@@#   :@@:                    #@+     .@@@-                 \n                             *@@#   :@@@:                 .%@@+     .@@@-                 \n                   -=:       *@@#   :@@@@+++++++++++++++==%@@@+     .@@@@@@@%#=.          \n                  :@@@       *@@#   :@@@@@@@@@@@@@@@@@@@@@@@@@+     .@@@%%%%@@@@#.        \n                   .:        *@@#   :@@@@@@@@@@@@@@@@@@@@@@@@@+     .@@@-    :%@@%        \n                             *@@#   :@@@@@%++#@@@@@@@%++#@@@@@+     .@@@-     :@@@:       \n                  .*#=       *@@#   :@@@@# ** *@@@@@% +#.=@@@@+     .@@@-     *@@@.       \n                  =@@@       *@@#   :@@@@@-::-%@@@@@@=.::%@@@@+   . .@@@#+++#@@@@-        \n                  +@@@       *@@#   :@@@@@@@@@@@***%@@@@@@@@@@+ -%+ .@@@@@@@@@@@=         \n                  %@@*       *@@#   :@@@@@@@@@@@* +%@@@@@@@@@@+-@:  .@@@=...-*@@@*        \n                 -@@@:       *@@#   :@@@@@@@@@@@@%@@@@@@@@@@@@+%*   .@@@-     -@@@:       \n                .@@@*        *@@#   :@@@@@@@@@@@@@@@@@@@@@@@@@+%+   .@@@-     -@@@:       \n                *@@@         *@@#   :@@@@@@@@@@@@@@@@@@@@@@@@@+*%   .@@@+:::-*@@@*        \n               .@@@+         *@@#   :@@@@@@@@@@@@@@@@@@@@@@@@@+ %*  .@@@@@@@@@@@=         \n               -@@@.         *@@#   :@@@@@@@@@@@@@@@@@@@@@@@@@+  #* .@@@*+++*@@@@-        \n               +@@@          *@@#   :@@@@@@@@@@@@@@@@@@@@@@@@@+  :@ .@@@-     *@@@.       \n               #@@#          *@@#    +%@@@@@@@@@@@@@@@@@@@@@@@#**#+ .@@@-     :@@@:       \n               %@@*          *@@#                                   .@@@-    -%@@%        \n               @@@+          *@@#                                   .@@@@%%%@@@@#.        \n              +@@@+          *@@#                                   .@@@@%%%@@@@*.        \n           .+@@@@=           *@@#                                   .@@@-    -%@@%        \n         .+@@@%=             *@@#                                   .@@@-     :@@@:       \n        *@@@%-               *@@%                                   .@@@-     *@@@.       \n        #@%-                 *@@%                                   .@@@*+++*@@@@-        \n                             =@@@:                                  =@@@@@@@@@%=          \n                              #@@@#+++++++++++++++++++++++++++++++*%@@@+::::.             \n                               -#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*.                   \n                                  .:::::::::::::::+#@@@@%=::::::::..                      \n                                            .:=*%@@@@@*:                                  \n                                   ::-=+*#%@@@@@@%*=.                                     \n                                 -@@@@@@@@@%*+-.                                          \n                               :%@@@*=-:.                                                 \n                             .*@@@*.                                                      \n                            +@@@%:                                                        \n                           .%@%-                                                          \n",
          //   "color: rgb(217,31,38); font-size: 10px ; font-weight: bold ;"
          // );
          console.group(
            "%c CutCat",
            "font-weight: bold; font-size: 50px;color: red; text-shadow: 3px 3px 0 rgb(217,31,38) , 6px 6px 0 rgb(226,91,14) , 9px 9px 0 rgb(245,221,8) , 12px 12px 0 rgb(5,148,68) , 15px 15px 0 rgb(2,135,206) , 18px 18px 0 rgb(4,77,145) , 21px 21px 0 rgb(42,21,113)"
          );
          console.log(
            "Created by : " + "%cAnis Snoussi",
            "background-color: rgb(217,31,38) ; color: #ffffff ; font-weight: bold ; padding: 4px ;"
          );
          console.log(
            "Contact email : " + "%csnoussi.anis@insat.u-carthage.tn",
            "background-color: rgb(217,31,38) ; color: #ffffff ; font-weight: bold ; padding: 4px ;"
          );
          console.log(
            "Open Source : " + "%chttps://github.com/ansnoussi/CutCat",
            "background-color: rgb(217,31,38) ; color: #ffffff ; font-weight: bold ; padding: 4px ;"
          );
          console.log(
            "License : " + "%cI don't even know...",
            "background-color: rgb(217,31,38) ; color: #ffffff ; font-weight: bold ; padding: 4px ;"
          );

          console.groupEnd();

          return socket.disconnect();
        }, []);

        const joinTopic = () => {
          fetch("http://" + document.domain + ":" + location.port + "/join", {
            method: "POST",
          });
        };

        const listenToEevnts = () => {
          fetch(
            "http://" +
              document.domain +
              ":" +
              location.port +
              "/get_cur_session",
            { method: "GET" }
          )
            .then((rez) => {
              return rez.text();
            })
            .then((session_id_as_topic_name) => {
              socket.on(session_id_as_topic_name, (receivedMsg) => {
                console.log("Received message" + receivedMsg);
                setMsg([...msg, receivedMsg.message]);
              });
            })
            .then(() => {
              console.log("started listening for events.");
            })
            .catch((e) => {
              console.log(e);
            });
        };

        const postInTopic = () => {
          console.log("will post in topic");
          fetch(
            "http://" + document.domain + ":" + location.port + "/post_topic",
            {
              method: "POST",
            }
          )
            .then(() => {
              console.log("posted");
            })
            .catch((e) => {
              console.log(e);
            });
        };

        return (
          <div>
            <h1> welcome </h1>
            {msg.map((m) => (
              <p>{m}</p>
            ))}
            <button onClick={joinTopic}>JOIN</button>
            <button onClick={listenToEevnts}>LISTEN</button>
            <button onClick={postInTopic}>POST-TOPIC</button>
          </div>
        );
      }

      ReactDOM.render(<Main />, document.getElementById("root"));
    </script>
  </body>
</html>
